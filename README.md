Estimote Beacons PhoneGap plugin
========================
- Just a wrapper around Estimote iOS SKD ( https://github.com/Estimote/iOS-SDK )
- SDK not included, needs to be added in the build process
- *NOTE* This is work in progress, it's not even a beta version yet. **Everything may change!**
- *NOTE* It's my first encounter with Objective-C and PhoneGap plugins. Therefore, code may be rubbish, however ATM it's just a proof of concept.
- Please **do** ask questions and give feedback. I will appreciate all input.

## Proof of concept app
I was able to build an app on the top of this plugin: http://www.youtube.com/watch?v=-cgvEY4ywM8

## Build process
What I'm doing now to build my app is:

- I call `phonegap build ios`
- I open the your-app-name.xcodeproj (generated by PhoneGap) in the Xcode
- I add Estimote SDK ( https://github.com/Estimote/iOS-SDK ) to the project (explained here: https://github.com/Estimote/iOS-SDK#installation )
- Install the Phonegap Estimote beacons plugin `phonegap local plugin add https://github.com/kdzwinel/phonegap-estimotebeacons`
- I run the app from the Xcode

## Basic usage

    // start looking for beacons
    window.EstimoteBeacons.startRangingBeaconsInRegion(function () {
        //every now and then get the list of beacons in range
        setInterval(function () {
            window.EstimoteBeacons.getBeacons(function (data) {
                //do something cool with the list of beacons
            });
        }, 1000);
    });
    
## Hello Beacons Phonegap Example

Modify the Phonegap Hello World example to add beacon support.

### index.html

Add some divs to the page where we can display beacon properties.

    <div id="beacon">
		<div id="accuracy">accuracy</div>
		<div id="debugDescription">debugDescription</div>
		<div id="description">description</div>
		<div id="isConnected">isConnected</div>
		<div id="proximity">proximity</div>
		<div id="proximityUUID">proximityUUID</div>
		<div id="rssi">rssi</div>
    </div>

### index.js

Add this code to index.js after deviceReady event is received from phonegap.

    // start looking for beacons
    window.EstimoteBeacons.startRangingBeaconsInRegion(function () {
        // every 5 seconds get the list of beacons in range
        setInterval(function () {
            window.EstimoteBeacons.getBeacons(function (beacons) {
				// TODO: Check for null beacon
				
				// display some properties from the first beacon in the array
				var beacon = beacons[0];
				document.getElementById("accuracy").innerHTML = beacon.accuracy.toString();
				document.getElementById("debugDescription").innerHTML = beacon.debugDescription.toString();
				document.getElementById("description").innerHTML = beacon.description.toString();
				document.getElementById("isConnected").innerHTML = beacon.isConnected.toString();
				document.getElementById("proximity").innerHTML = beacon.proximity.toString();
				document.getElementById("proximityUUID").innerHTML = beacon.proximityUUID.toString();
				document.getElementById("rssi").innerHTML = beacon.rssi.toString();
            });
        }, 5000);
    });
    
## Some other stuff that you can do

`EstimoteBeacons.prototype.connectToBeacon = function(major, minor, callback, errorCallback) ...`
Allows you to connect to the beacon by providing major/minor of the beacon.

- *NOTE* Connected beacon goes 'invisible' until it disconnects
- *NOTE* You can be connected only to the one beacon at the time.
- *NOTE* You need to connect to the beacon to do any *write* opperatons (update software, change frequency etc.)

`EstimoteBeacons.prototype.connectToBeaconByMacAddress = function(macAddress, callback, errorCallback) ...`
Allows you to connect to the beacon by providing its MAC Address. I used that to connect to the beacons with old software ( < v1.6 ).

- *NOTE* You have to use startEstimoteBeaconsDiscoveryForRegion to connect to the beacons with old software.

`EstimoteBeacons.prototype.disconnectFromBeacon = function(callback, errorCallback)...`
Disconnects you from the connected beacon. Since there can be only one, you don't have to provide major/minor or MAC.

`EstimoteBeacons.prototype.setFrequencyOfConnectedBeacon = function(frequency, callback, errorCallback)...`
Sets the frequency of the connected beacon. You can set anything between 80 and 3200.

`EstimoteBeacons.prototype.setPowerOfConnectedBeacon = function(power, callback, errorCallback) ...`
Sets the power of the connected beacon. You can choose from -40, -20, -16, -12, -8, -4, 0, 4.

`EstimoteBeacons.prototype.startVirtualBeacon = function (major, minor, id, successCallback) ...`
Device starts advertising as a beacon with given major/minor and id.

- *NOTE* You can't conect to the virtual beacon.
- *NOTE* Device that acts as a virtual beacon can still see other beacons, but won't see itself.

`EstimoteBeacons.prototype.stopVirtualBeacon = function(successCallback) ...`
Device stops advertising as a beacon.

`EstimoteBeacons.prototype.updateFirmwareOfConnectedBeacon = function(progressCallback, successCallback, errorCallback) ..`
Updates the softwere of connected beacon (if needed).

- *NOTE* I was able to succesfully upgrade 3 devices with that method so it's tested, but still - use it with caution! Make sure that beacon is near the phone, make sure that your phone has stable connection to the Internet and keep your fingers crossed.
